# 中间件管理界面功能需求文档

**版本：** v1.0.0  \\
**完成日期：** 2025-11-14  \\
**编写人：** 虎门医院信息科 / 信息化项目组

## 1. 引言
### 1.1 文档目的

本需求文档用于描述“加密中间件管理界面”的功能需求、界面需求、技术／非功能需求。目标是为开发团队（如 Codex ）提供清晰、可执行、可验收的参考。

### 1.2 项目背景

医院已有多套业务系统（如 HIS、医技系统、费用系统），其数据库中存在敏感字段（如患者 ID、医保号、药品耗材编码等）存储为明文。拟部署一个加密中间件，支持国产国密算法，实现敏感字段落库加密、已有明文迁移，并新增一个 B/S 管理界面，用于配置、监控、运维管理。

### 1.3 目标范围

为中间件提供一个 B/S 界面，包括角色管理、敏感字段配置、迁移任务管理、状态监控、审计日志导出、系统设置等模块。

界面须与中间件服务协作，通过接口获取状态、配置、任务、日志等数据。

界面部署于医院内网，可在 PC 端浏览器访问。

### 1.4 术语与缩略语

| 缩略语 | 含义 |
| --- | --- |
| HIS | 医院信息系统 |
| SM2/SM3/SM4 | 国密算法标准 |
| B/S | 浏览器／服务器架构 |
| API | 应用程序接口 |
| UI | 用户界面 |
| DB | 数据库 |

## 2. 用户角色与权限

| 角色 | 描述 | 可访问功能 |
| --- | --- | --- |
| 系统管理员 | 医院信息科负责人 | 全部功能（配置、迁移、日志、密钥、用户管理） |
| 运维人员 | 中间件日常运维 | 迁移任务监控、日志查看、密钥状态、配置查看／修改部分 |
| 安全审计人员 | 负责审计与报告 | 日志查看、导出报表（只读） |

## 3. 功能需求
### 3.1 登录与权限管理

- 支持用户名+密码登录，预留二次认证（2FA）扩展。
- 系统管理员可新增／编辑用户、分配角色。
- 登录后根据角色显示不同菜单与功能模块。

### 3.2 敏感字段清单管理

- 显示敏感字段配置表：字段 ID、所属表名、字段名、加密算法、当前状态（未加密／已加密）、是否允许明文读取、备注。
- 操作：新增字段、编辑字段、逻辑删除（禁用）、启用／禁用字段。
- 支持搜索与筛选：按表名、字段名、状态、算法类型。
- 支持批量导入／导出（Excel/CSV）。

### 3.3 迁移任务管理

- 显示迁移任务列表：任务 ID、关联字段／表、开始时间、完成时间、进度（%）、状态（待启动/进行中/完成/失败）、操作者。
- 新建任务：选择表+字段、配置批次大小、并发数、是否覆盖原明文字段／新增密文字段。
- 实时监控：点击任务查询详细进度（已处理条数、成功数、失败数、错误原因）、可暂停／取消任务。
- 历史任务档案：查看已完成／失败任务详情，支持导出报告。
- 告警机制：当任务失败或失败比例超过预设阈值时，在界面提示并生成告警。

### 3.4 加密服务状态监控

- 显示服务运行状态：启动时间、运行时长、当前线程数／任务数、累计加密次数、累计解密次数、错误次数。
- 显示密钥状态：当前版本号、有效期、上次轮换时间、是否过期／即将过期提醒。
- 系统负载监控（建议项）：CPU、内存、磁盘 I/O、数据库连接数。
- 显示近期严重错误或警告日志（如最近 10 条）。

### 3.5 审计日志查看与导出

- 支持日志类型筛选：加密／解密操作日志、代理读写日志、迁移任务日志、密钥操作日志。
- 筛选条件：日期范围、操作类型、用户、表名、字段名、任务 ID。
- 查看日志详情：时间、用户、IP、操作类型、表名、字段名、业务 ID、链接 ID（link_id）、状态、错误信息。
- 导出功能：支持 CSV／Excel／PDF 格式。
- 报表：生成如“每日加密操作量统计”、“迁移任务成功／失败比例报表”。

### 3.6 配置管理 & 系统设置

- 系统参数：默认并发数、批次大小、日志保留期限、加密算法默认类型等。
- 环境配置：数据库连接、服务端口、认证方式（LDAP/本地登录）等。
- 安全配置：密码策略（长度、复杂度、过期）、账户锁定策略。
- 备份／恢复：支持导出系统配置、敏感字段清单、历史任务记录；支持从备份文件恢复设置。

### 3.7 用户帮助与文档

- 在线帮助页面：模块简介、常见 FAQ、操作指南。
- 下载区：部署手册、用户手册、接口文档 PDF 格式。
- 关于界面：版本信息、发布日期、版权声明。

## 4. 非功能需求
### 4.1 性能需求

- 管理界面加载大量数据（如日志百万条）时，首次视图响应时间不超过 3 秒。
- 导出报表操作响应时间不超过 10 秒（视服务器性能）。

### 4.2 安全需求

- 界面访问必须通过 HTTPS。
- 登录后会话支持超时机制（如 10 分钟无操作自动退出）。
- 所有操作记录 IP 地址和用户信息。
- 界面数据传输、敏感配置不得明文存储。

### 4.3 可用性需求

- 界面应支持主流浏览器（Chrome、Edge、Firefox）最新版本。
- 界面布局应适配桌面 PC 使用。

### 4.4 可维护性 & 可扩展性

- 敏感字段清单配置可动态更新，无需整体系统重构。
- 模块化设计便于未来新增功能（如 API 使用统计模块）而不影响现有模块。

### 4.5 部署与兼容性

- 系统应支持医院内部局域网部署。
- 支持容器化部署（Docker）或传统单机服务部署。
- 界面服务应与中间件服务接口明确、兼容。

## 5. 界面模块概要与导航结构

- 登录页面。
- 主页面（导航菜单：敏感字段／迁移任务／监控状态／审计日志／配置管理／用户管理／帮助）。
- 每个模块采用表格+操作按钮+筛选组件布局。
- 模态弹窗或侧弹侧栏用于新增或编辑操作。
- 仪表板页面展示加密服务状态、热力图／趋势图（可使用 canvas 或 chart 库）。

## 6. 接口 & 数据模型示例
### 6.1 接口示例

- `GET /api/monitor/status`：返回服务状态数据。
- `GET /api/migration/tasks`：返回迁移任务列表。
- `POST /api/migration/tasks`：创建新迁移任务。
- `GET /api/fields/sensitive`：返回敏感字段清单。
- ……（更多接口按模块定义）。

### 6.2 数据模型示例（敏感字段清单）

```json
{
  "fieldId": "SF001",
  "tableName": "patient_info",
  "fieldName": "patient_id_plain",
  "algorithmType": "SM4",
  "status": "未加密",
  "allowPlainTextRead": false,
  "remarks": "患者主 ID 字段"
}
```

## 7. 里程碑 & 交付物

| 里程碑 | 预计完成时间 |
| --- | --- |
| 界面原型（Figma/Mockup） | 2025-12-01 |
| 前后端接口定义 | 2025-12-10 |
| 管理界面模块开发 | 2026-01-10 |
| 单元测试与用户验收 | 2026-01-25 |
| 部署上线 | 2026-02-01 |
| 文档交付（用户手册／运维手册／接口文档） | 2026-02-05 |

## 8. 风险与注意事项

- 管理界面功能暴露敏感操作（如迁移任务启动、密钥查看）须做好权限控制与日志审计。
- 日志数据量大可能影响界面性能，需注意分页、异步加载、缓存策略。
- 部署在医院内网环境，浏览器兼容、网络条件较差时需优化界面响应。
- 所有敏感数据（如密钥状态、字段配置）在界面展示前应考虑权限和数据脱敏。
